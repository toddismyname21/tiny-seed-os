<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Tiny Seed OS - Label Generator</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=Oswald:wght@400;500;600;700&family=Montserrat:wght@400;500;600;700;800&family=Bebas+Neue&family=Raleway:wght@400;500;600;700;800&display=swap" rel="stylesheet">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --primary: #22c55e;
            --primary-dark: #16a34a;
            --bg-dark: #0f172a;
            --bg-card: #1e293b;
            --bg-elevated: #334155;
            --text-primary: #f8fafc;
            --text-secondary: #94a3b8;
            --border: #334155;
            --danger: #ef4444;
            --warning: #f59e0b;
            --info: #3b82f6;
        }

        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: var(--bg-dark);
            color: var(--text-primary);
            min-height: 100vh;
        }

        /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
           SCREEN STYLES (not printed)
           â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */

        .screen-only {
            padding: 24px;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
        }

        header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 32px;
            flex-wrap: wrap;
            gap: 16px;
        }

        .header-left {
            display: flex;
            align-items: center;
            gap: 16px;
        }

        .back-btn {
            background: var(--bg-card);
            border: 1px solid var(--border);
            color: var(--text-primary);
            padding: 10px 16px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 14px;
            text-decoration: none;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .back-btn:hover {
            background: var(--bg-elevated);
        }

        h1 {
            font-size: 28px;
            font-weight: 700;
        }

        .header-right {
            display: flex;
            gap: 12px;
        }

        .btn {
            padding: 10px 20px;
            border-radius: 8px;
            font-size: 14px;
            font-weight: 500;
            cursor: pointer;
            border: none;
            transition: all 0.2s;
        }

        .btn-primary {
            background: var(--primary);
            color: white;
        }

        .btn-primary:hover {
            background: var(--primary-dark);
        }

        .btn-secondary {
            background: var(--bg-card);
            border: 1px solid var(--border);
            color: var(--text-primary);
        }

        .btn-secondary:hover {
            background: var(--bg-elevated);
        }

        /* Tabs */
        .tabs {
            display: flex;
            gap: 4px;
            background: var(--bg-card);
            padding: 6px;
            border-radius: 12px;
            margin-bottom: 24px;
        }

        .tab {
            padding: 12px 24px;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 500;
            font-size: 14px;
            color: var(--text-secondary);
            transition: all 0.2s;
            border: none;
            background: none;
        }

        .tab:hover {
            color: var(--text-primary);
            background: var(--bg-elevated);
        }

        .tab.active {
            background: var(--primary);
            color: white;
        }

        /* Controls Panel */
        .controls-panel {
            background: var(--bg-card);
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 24px;
            display: flex;
            flex-wrap: wrap;
            gap: 16px;
            align-items: flex-end;
        }

        .control-group {
            display: flex;
            flex-direction: column;
            gap: 6px;
        }

        .control-group label {
            font-size: 12px;
            font-weight: 500;
            color: var(--text-secondary);
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .control-group select,
        .control-group input {
            padding: 10px 14px;
            border-radius: 8px;
            border: 1px solid var(--border);
            background: var(--bg-dark);
            color: var(--text-primary);
            font-size: 14px;
            min-width: 180px;
        }

        .control-group select:focus,
        .control-group input:focus {
            outline: none;
            border-color: var(--primary);
        }

        .stats-row {
            display: flex;
            gap: 24px;
            margin-left: auto;
        }

        .stat-item {
            text-align: center;
        }

        .stat-value {
            font-size: 24px;
            font-weight: 700;
            color: var(--primary);
        }

        .stat-label {
            font-size: 12px;
            color: var(--text-secondary);
        }

        /* Labels Grid Preview */
        .labels-preview {
            background: var(--bg-card);
            border-radius: 12px;
            padding: 24px;
            min-height: 400px;
        }

        .preview-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 16px;
            border-bottom: 1px solid var(--border);
        }

        .preview-title {
            font-size: 18px;
            font-weight: 600;
        }

        .select-all-container {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .select-all-container input[type="checkbox"] {
            width: 18px;
            height: 18px;
            cursor: pointer;
        }

        /* Market Signs Grid - Preview (exact proportions from source) */
        .market-signs-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            gap: 24px;
        }

        .market-sign-preview {
            background: white;
            border-radius: 6px;
            overflow: hidden;
            color: #1a1a1a;
            cursor: pointer;
            border: 3px solid transparent;
            transition: all 0.2s;
            display: flex;
            flex-direction: column;
            aspect-ratio: 0.72;  /* Matching source ~4:5.5 portrait */
        }

        .market-sign-preview:hover {
            border-color: var(--primary);
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(0,0,0,0.15);
        }

        .market-sign-preview.selected {
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(34, 197, 94, 0.3);
        }

        /* Main content: 85% of card height (header 40% + price 45%) */
        .market-sign-preview .sign-content {
            flex: 0 0 85%;
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 0;
            text-align: center;
        }

        /* Header area: crop name + variety = 40% of total sign (~47% of content area) */
        /* Content pushed to bottom so variety sits at bottom edge */
        .market-sign-preview .header-area {
            flex: 0 0 47%;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: flex-end;  /* Push content to bottom */
            width: 100%;
            padding: 2% 0 0 0;
        }

        /* Item name: Bold, Title Case - stacks words vertically */
        .market-sign-preview .item-name {
            font-family: 'Montserrat', sans-serif;
            font-weight: 700;
            line-height: 1.0;
            color: #1a1a1a;
            letter-spacing: -0.5px;
            display: flex;
            flex-direction: column;
            align-items: center;
            width: 100%;
        }

        /* Each word stacks on its own line */
        .market-sign-preview .item-name .crop-word {
            font-size: 38px;  /* Default size, will shrink if needed */
            white-space: nowrap;
        }

        /* Variety: italic serif below crop name - proportional to header */
        .market-sign-preview .variety {
            font-family: 'Georgia', serif;
            font-size: 16px;
            font-style: italic;
            color: #666;
            margin-top: 6px;
            margin-bottom: 2%;
        }

        /* Price section: 45% of sign (~53% of content) - price perfectly centered */
        .market-sign-preview .price-section {
            flex: 0 0 53%;
            display: flex;
            align-items: center;
            justify-content: center;
            width: 100%;
        }

        /* Price wrapper: positions badge relative to centered price */
        .market-sign-preview .price-wrapper {
            position: relative;
            display: inline-block;
        }

        /* Price number - BIG, this is what gets centered */
        .market-sign-preview .price-number {
            font-family: 'Montserrat', sans-serif;
            font-size: 90px;
            font-weight: 700;
            color: #1a1a1a;
            line-height: 0.9;
        }

        /* Unit badge: fixed size, positioned to right of price, bottom aligned */
        .market-sign-preview .unit-badge {
            font-family: 'Montserrat', sans-serif;
            font-size: 9px;
            font-weight: 600;
            color: #555;
            background: #d4d4d4;
            padding: 3px 6px;
            border-radius: 3px;
            text-transform: uppercase;
            letter-spacing: 0.3px;
            white-space: nowrap;
            position: absolute;
            left: 100%;
            bottom: 0;
            margin-left: -6px;  /* Overlap price slightly */
        }

        /* Footer: 15% of card height */
        .market-sign-preview .sign-footer {
            flex: 0 0 15%;
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 0 6%;
            background: #16a34a;
        }

        .market-sign-preview.category-floral .sign-footer {
            background: #db2777;
        }

        .market-sign-preview.category-mushroom .sign-footer {
            background: #78350f;
        }

        .market-sign-preview .tagline {
            font-family: 'Inter', sans-serif;
            font-size: clamp(6px, 1.8vw, 9px);
            font-weight: 600;
            color: white;
            letter-spacing: 0.8px;
        }

        .market-sign-preview .logo-img {
            height: clamp(18px, 6vw, 28px);
            width: auto;
            /* Logo is already white on transparent - no filter needed */
        }

        .market-sign-preview .logo-text {
            font-family: 'Oswald', sans-serif;
            font-size: clamp(9px, 2.5vw, 12px);
            font-weight: 700;
            color: white;
            background: rgba(255,255,255,0.2);
            padding: 2px 8px;
            border-radius: 3px;
        }

        /* CSA/Wholesale Labels Grid - Preview */
        .labels-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
            gap: 16px;
        }

        .label-preview {
            background: white;
            border-radius: 8px;
            padding: 16px;
            color: #1a1a1a;
            cursor: pointer;
            border: 3px solid transparent;
            transition: all 0.2s;
        }

        .label-preview:hover {
            border-color: var(--primary);
        }

        .label-preview.selected {
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(34, 197, 94, 0.3);
        }

        .label-preview .customer-name {
            font-weight: 700;
            font-size: 16px;
            margin-bottom: 8px;
        }

        .label-preview .items-list {
            font-size: 13px;
            color: #444;
        }

        .label-preview .items-list li {
            margin-bottom: 4px;
        }

        /* Empty State */
        .empty-state {
            text-align: center;
            padding: 60px 20px;
            color: var(--text-secondary);
        }

        .empty-state-icon {
            font-size: 48px;
            margin-bottom: 16px;
            opacity: 0.5;
        }

        /* Manual Entry Form */
        .manual-entry-section {
            background: var(--bg-card);
            border-radius: 12px;
            padding: 24px;
            margin-top: 24px;
        }

        .manual-entry-section h3 {
            margin-bottom: 16px;
            font-size: 16px;
        }

        .manual-form-row {
            display: flex;
            gap: 12px;
            flex-wrap: wrap;
        }

        .manual-form-row input {
            flex: 1;
            min-width: 150px;
            padding: 10px 14px;
            border-radius: 8px;
            border: 1px solid var(--border);
            background: var(--bg-dark);
            color: var(--text-primary);
            font-size: 14px;
        }

        /* Loading State */
        .loading {
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 60px;
        }

        .spinner {
            width: 40px;
            height: 40px;
            border: 3px solid var(--border);
            border-top-color: var(--primary);
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
           PRINT STYLES - MARKET SIGNS (6 per letter page)
           Matching the Tiny Seed Farm design with category-based footer colors
           â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */

        @media print {
            @page {
                margin: 0.25in;
                size: letter;
            }

            .screen-only {
                display: none !important;
            }

            body {
                background: white;
                color: black;
                margin: 0;
                padding: 0;
            }

            /* Market Signs Print Layout - 4 per page (2x2)
               Each sign: 4" x 5" (fits 2 across, 2 down on letter with minimal margins)
               Proportions match source exactly */
            .print-market-signs {
                display: grid !important;
                grid-template-columns: repeat(2, 4in);
                grid-auto-rows: 5in;
                gap: 0;
                width: 8in;
                margin: 0;
                padding: 0;
            }

            .market-sign-print {
                width: 4in;
                height: 5in;
                display: flex;
                flex-direction: column;
                background: white;
                border: 1px dashed #ccc;
                page-break-inside: avoid;
                box-sizing: border-box;
                overflow: hidden;
            }

            /* Main content: 85% of sign height (header 40% + price 45%) */
            .market-sign-print .sign-content {
                flex: 0 0 85%;
                display: flex;
                flex-direction: column;
                align-items: center;
                padding: 0;
                text-align: center;
            }

            /* Header area: crop name + variety = 40% of total sign (~47% of content area) */
            /* Content pushed to bottom so variety sits at bottom edge */
            .market-sign-print .header-area {
                flex: 0 0 47%;
                display: flex;
                flex-direction: column;
                align-items: center;
                justify-content: flex-end;  /* Push content to bottom */
                width: 100%;
                padding: 0.1in 0 0 0;
            }

            /* Item name: Bold, Title Case - stacks words vertically */
            .market-sign-print .item-name {
                font-family: 'Montserrat', sans-serif;
                font-weight: 700;
                line-height: 1.0;
                color: #1a1a1a;
                letter-spacing: -0.5pt;
                display: flex;
                flex-direction: column;
                align-items: center;
                width: 100%;
            }

            /* Each word stacks on its own line */
            .market-sign-print .item-name .crop-word {
                font-size: 42pt;
                white-space: nowrap;
            }

            /* Variety: italic serif below crop name */
            .market-sign-print .variety {
                font-family: 'Georgia', serif;
                font-size: 20pt;
                font-style: italic;
                color: #666;
                margin-top: 0.1in;
                margin-bottom: 0.1in;
            }

            /* Price section: 45% of sign (~53% of content) - price perfectly centered */
            .market-sign-print .price-section {
                flex: 0 0 53%;
                display: flex;
                align-items: center;
                justify-content: center;
                width: 100%;
            }

            /* Price wrapper: positions badge relative to centered price */
            .market-sign-print .price-wrapper {
                position: relative;
                display: inline-block;
            }

            /* Price number - BIG, this is what gets centered */
            .market-sign-print .price-number {
                font-family: 'Montserrat', sans-serif;
                font-weight: 700;
                color: #1a1a1a;
                line-height: 0.9;
            }

            .market-sign-print .price-number.single-digit {
                font-size: 120pt;
            }

            .market-sign-print .price-number.double-digit {
                font-size: 90pt;
            }

            /* Unit badge: fixed size, positioned to right of price, bottom aligned */
            .market-sign-print .unit-badge {
                font-family: 'Montserrat', sans-serif;
                font-size: 11pt;
                font-weight: 600;
                color: #555;
                background: #d4d4d4;
                padding: 0.04in 0.08in;
                border-radius: 4px;
                text-transform: uppercase;
                letter-spacing: 0.3px;
                white-space: nowrap;
                position: absolute;
                left: 100%;
                bottom: 0;
                margin-left: -0.08in;  /* Overlap price slightly */
            }

            /* Footer: 15% of sign height */
            .market-sign-print .sign-footer {
                flex: 0 0 15%;
                display: flex;
                justify-content: space-between;
                align-items: center;
                padding: 0 6%;
                background: #16a34a;
            }

            /* Pink footer for floral */
            .market-sign-print.category-floral .sign-footer {
                background: #db2777;
            }

            /* Brown footer for mushrooms */
            .market-sign-print.category-mushroom .sign-footer {
                background: #78350f;
            }

            .market-sign-print .tagline {
                font-family: 'Inter', sans-serif;
                font-size: 11pt;
                font-weight: 600;
                color: white;
                letter-spacing: 1px;
            }

            .market-sign-print .logo-area {
                display: flex;
                align-items: center;
            }

            .market-sign-print .logo-text {
                font-family: 'Oswald', sans-serif;
                font-size: 14pt;
                font-weight: 700;
                color: white;
                background: rgba(255,255,255,0.2);
                padding: 0.04in 0.12in;
                border-radius: 3px;
            }

            .market-sign-print .logo-img {
                height: 0.5in;
                width: auto;
                /* Logo is already white on transparent - no filter needed */
            }

            /* CSA Labels Print - 2.4" Brother labels */
            .print-csa-labels {
                display: block !important;
            }

            .csa-label-print {
                width: 2.4in;
                padding: 0.1in;
                border-bottom: 1px dashed #ccc;
                page-break-inside: avoid;
                margin-bottom: 0.1in;
            }

            .csa-label-print .label-header {
                font-family: 'Inter', sans-serif;
                font-size: 10pt;
                font-weight: 700;
                margin-bottom: 0.05in;
                padding-bottom: 0.05in;
                border-bottom: 1px solid #000;
            }

            .csa-label-print .customer-name {
                font-size: 12pt;
                font-weight: 700;
                margin-bottom: 0.05in;
            }

            .csa-label-print .items-list {
                font-size: 9pt;
                list-style: none;
                padding: 0;
            }

            .csa-label-print .items-list li {
                margin-bottom: 2px;
            }

            /* Wholesale Labels Print - 2.4" Brother labels */
            .print-wholesale-labels {
                display: block !important;
            }

            .wholesale-label-print {
                width: 2.4in;
                padding: 0.1in;
                border-bottom: 1px dashed #ccc;
                page-break-inside: avoid;
                margin-bottom: 0.1in;
            }

            .wholesale-label-print .customer-name {
                font-size: 12pt;
                font-weight: 700;
                margin-bottom: 0.05in;
                padding-bottom: 0.05in;
                border-bottom: 1px solid #000;
            }

            .wholesale-label-print .items-list {
                font-size: 9pt;
                list-style: none;
                padding: 0;
            }

            .wholesale-label-print .items-list li {
                margin-bottom: 3px;
                display: flex;
                justify-content: space-between;
            }

            /* Page breaks */
            .page-break {
                page-break-after: always;
            }
        }

        /* Hide print containers on screen */
        .print-container {
            display: none;
        }

        @media screen {
            .print-container {
                display: none;
            }
        }
    </style>
</head>
<body>
    <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
         SCREEN UI
         â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
    <div class="screen-only">
        <div class="container">
            <header>
                <div class="header-left">
                    <a href="index.html" class="back-btn">
                        <span>&larr;</span> Back
                    </a>
                    <h1>Label Generator</h1>
                </div>
                <div class="header-right">
                    <button class="btn btn-secondary" onclick="loadData()">
                        Refresh Data
                    </button>
                    <button class="btn btn-primary" onclick="printSelected()">
                        Print Selected
                    </button>
                </div>
            </header>

            <!-- Tabs -->
            <div class="tabs">
                <button class="tab active" data-tab="market" onclick="switchTab('market')">
                    Market Signs
                </button>
                <button class="tab" data-tab="csa" onclick="switchTab('csa')">
                    CSA Labels
                </button>
                <button class="tab" data-tab="wholesale" onclick="switchTab('wholesale')">
                    Wholesale Labels
                </button>
            </div>

            <!-- Controls Panel -->
            <div class="controls-panel">
                <div class="control-group">
                    <label>Delivery Date</label>
                    <input type="date" id="deliveryDate" onchange="loadData()">
                </div>
                <div class="control-group" id="customerTypeControl" style="display: none;">
                    <label>Customer Type</label>
                    <select id="customerType" onchange="filterLabels()">
                        <option value="">All Types</option>
                        <option value="CSA">CSA</option>
                        <option value="Wholesale">Wholesale</option>
                        <option value="Retail">Retail</option>
                    </select>
                </div>
                <div class="stats-row">
                    <div class="stat-item">
                        <div class="stat-value" id="totalLabels">0</div>
                        <div class="stat-label">Total Items</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-value" id="selectedLabels">0</div>
                        <div class="stat-label">Selected</div>
                    </div>
                </div>
            </div>

            <!-- Market Signs Tab -->
            <div id="marketTab" class="tab-content">
                <div class="labels-preview">
                    <div class="preview-header">
                        <span class="preview-title">Market Signs Preview</span>
                        <div class="select-all-container">
                            <input type="checkbox" id="selectAllMarket" onchange="toggleSelectAll('market')">
                            <label for="selectAllMarket">Select All</label>
                        </div>
                    </div>
                    <div id="marketSignsGrid" class="market-signs-grid">
                        <div class="loading">
                            <div class="spinner"></div>
                        </div>
                    </div>
                </div>

                <!-- Manual Entry for Market Signs -->
                <div class="manual-entry-section">
                    <h3>Add Manual Market Sign</h3>
                    <div class="manual-form-row">
                        <input type="text" id="manualItemName" placeholder="Item Name (e.g., Tomatoes)">
                        <input type="text" id="manualVariety" placeholder="Variety (optional)">
                        <input type="number" id="manualPrice" placeholder="Price" step="0.01">
                        <input type="text" id="manualUnit" placeholder="Unit (e.g., /lb, /bunch)">
                        <button class="btn btn-primary" onclick="addManualMarketSign()">Add Sign</button>
                    </div>
                </div>
            </div>

            <!-- CSA Labels Tab -->
            <div id="csaTab" class="tab-content" style="display: none;">
                <div class="labels-preview">
                    <div class="preview-header">
                        <span class="preview-title">CSA Labels Preview</span>
                        <div class="select-all-container">
                            <input type="checkbox" id="selectAllCSA" onchange="toggleSelectAll('csa')">
                            <label for="selectAllCSA">Select All</label>
                        </div>
                    </div>
                    <div id="csaLabelsGrid" class="labels-grid">
                        <div class="empty-state">
                            <div class="empty-state-icon">ğŸ“¦</div>
                            <p>CSA labels will appear here based on orders</p>
                        </div>
                    </div>
                </div>
                <div class="manual-entry-section">
                    <h3>Add Manual CSA Label</h3>
                    <div class="manual-form-row">
                        <input type="text" id="manualCSACustomer" placeholder="Customer Name">
                        <input type="text" id="manualCSAItems" placeholder="Items (comma separated)">
                        <button class="btn btn-primary" onclick="addManualCSALabel()">Add Label</button>
                    </div>
                </div>
            </div>

            <!-- Wholesale Labels Tab -->
            <div id="wholesaleTab" class="tab-content" style="display: none;">
                <div class="labels-preview">
                    <div class="preview-header">
                        <span class="preview-title">Wholesale Labels Preview</span>
                        <div class="select-all-container">
                            <input type="checkbox" id="selectAllWholesale" onchange="toggleSelectAll('wholesale')">
                            <label for="selectAllWholesale">Select All</label>
                        </div>
                    </div>
                    <div id="wholesaleLabelsGrid" class="labels-grid">
                        <div class="empty-state">
                            <div class="empty-state-icon">ğŸª</div>
                            <p>Wholesale labels will appear here based on orders</p>
                        </div>
                    </div>
                </div>
                <div class="manual-entry-section">
                    <h3>Add Manual Wholesale Label</h3>
                    <div class="manual-form-row">
                        <input type="text" id="manualWholesaleCustomer" placeholder="Customer/Business Name">
                        <input type="text" id="manualWholesaleProduct" placeholder="Product">
                        <input type="text" id="manualWholesaleQty" placeholder="Quantity">
                        <input type="text" id="manualWholesaleLot" placeholder="Lot # (optional)">
                        <button class="btn btn-primary" onclick="addManualWholesaleLabel()">Add Label</button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
         PRINT CONTAINERS (hidden on screen, shown when printing)
         â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->

    <!-- Market Signs Print Container -->
    <div id="printMarketSigns" class="print-container print-market-signs"></div>

    <!-- CSA Labels Print Container -->
    <div id="printCSALabels" class="print-container print-csa-labels"></div>

    <!-- Wholesale Labels Print Container -->
    <div id="printWholesaleLabels" class="print-container print-wholesale-labels"></div>

    <script>
        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        // CONFIGURATION
        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

        const API_URL = 'https://script.google.com/macros/s/AKfycbz23N_RluRDlJheaK0vTZmvfIkd5yyMblNizASjuuo6vsNibuoWIPt04KuZOCKEwaoj/exec';
        const FARM_NAME = 'TINY SEED FARM';
        const LOGO_PATH = 'assets/logo.png';  // Logo file path (CSS inverts to white)

        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        // STATE MANAGEMENT
        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

        const AppState = {
            currentTab: 'market',
            marketSigns: [],
            csaLabels: [],
            wholesaleLabels: [],
            selectedMarket: new Set(),
            selectedCSA: new Set(),
            selectedWholesale: new Set(),
            deliveryDate: null
        };

        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        // INITIALIZATION
        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

        document.addEventListener('DOMContentLoaded', () => {
            // Set default delivery date to today
            const today = new Date().toISOString().split('T')[0];
            document.getElementById('deliveryDate').value = today;
            AppState.deliveryDate = today;

            loadData();
        });

        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        // TAB SWITCHING
        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

        function switchTab(tab) {
            AppState.currentTab = tab;

            // Update tab buttons
            document.querySelectorAll('.tab').forEach(t => {
                t.classList.toggle('active', t.dataset.tab === tab);
            });

            // Show/hide tab content
            document.getElementById('marketTab').style.display = tab === 'market' ? 'block' : 'none';
            document.getElementById('csaTab').style.display = tab === 'csa' ? 'block' : 'none';
            document.getElementById('wholesaleTab').style.display = tab === 'wholesale' ? 'block' : 'none';

            // Show/hide customer type filter for non-market tabs
            document.getElementById('customerTypeControl').style.display = tab !== 'market' ? 'block' : 'none';

            updateStats();
        }

        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        // DATA LOADING
        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

        async function loadData() {
            const date = document.getElementById('deliveryDate').value;
            AppState.deliveryDate = date;

            // Show loading state
            document.getElementById('marketSignsGrid').innerHTML = '<div class="loading"><div class="spinner"></div></div>';

            try {
                // Load market items for signs
                await loadMarketSignItems();

                // Load orders for CSA/Wholesale labels
                await loadOrderLabels();

            } catch (error) {
                console.error('Error loading data:', error);
                showError('Failed to load data. Please try again.');
            }

            updateStats();
        }

        async function loadMarketSignItems() {
            const grid = document.getElementById('marketSignsGrid');

            try {
                // Set a timeout for the fetch
                const controller = new AbortController();
                const timeoutId = setTimeout(() => controller.abort(), 10000);

                const response = await fetch(`${API_URL}?action=getMarketSignItems`, {
                    signal: controller.signal
                });
                clearTimeout(timeoutId);

                const data = await response.json();

                if (data.success && data.items && data.items.length > 0) {
                    AppState.marketSigns = data.items;
                    console.log('Loaded', data.items.length, 'items from API');
                } else {
                    // Fall back to sample data for demo
                    console.log('No items from API, using sample data');
                    AppState.marketSigns = getSampleMarketItems();
                }

                renderMarketSigns();
            } catch (error) {
                console.error('Error loading market items:', error);
                // Use sample data on error (including CORS errors)
                console.log('Fetch failed, using sample data');
                AppState.marketSigns = getSampleMarketItems();
                renderMarketSigns();
            }
        }

        async function loadOrderLabels() {
            try {
                const response = await fetch(`${API_URL}?action=getOrdersForLabels&date=${AppState.deliveryDate}`);
                const data = await response.json();

                if (data.success) {
                    AppState.csaLabels = data.csaOrders || [];
                    AppState.wholesaleLabels = data.wholesaleOrders || [];
                }

                renderCSALabels();
                renderWholesaleLabels();
            } catch (error) {
                console.error('Error loading order labels:', error);
                renderCSALabels();
                renderWholesaleLabels();
            }
        }

        function getSampleMarketItems() {
            // Sample data for demonstration - includes veggies, flowers, and mushrooms
            return [
                { id: 1, name: 'Heirloom Tomatoes', variety: 'Cherokee Purple', price: 8, unit: '/lb', category: 'Vegetables' },
                { id: 2, name: 'Lettuce', variety: 'Butterhead', price: 4, unit: '/head', category: 'Vegetables' },
                { id: 3, name: 'Kale', variety: 'Lacinato', price: 4, unit: '/bunch', category: 'Vegetables' },
                { id: 4, name: 'Carrots', variety: 'Nantes', price: 3, unit: '/bunch', category: 'Vegetables' },
                { id: 5, name: 'Mixed Flower Bouquet', variety: 'Seasonal', price: 15, unit: '/each', category: 'Floral' },
                { id: 6, name: 'Sunflowers', variety: 'Pro Cut', price: 12, unit: '/bunch', category: 'Floral' },
                { id: 7, name: 'Shiitake Mushrooms', variety: 'Fresh', price: 14, unit: '/lb', category: 'Mushroom' },
                { id: 8, name: 'Oyster Mushrooms', variety: 'Blue', price: 12, unit: '/lb', category: 'Mushroom' }
            ];
        }

        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        // RENDERING
        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

        // Format crop name to Title Case, stack words as divs
        function formatCropName(name) {
            // Convert to Title Case and stack each word
            const words = name.trim().toLowerCase().split(/\s+/).map(word =>
                word.charAt(0).toUpperCase() + word.slice(1)
            );
            // Each word gets its own div so they stack
            const formattedName = words.map(w => `<div class="crop-word">${w}</div>`).join('');
            return formattedName;
        }

        // Dynamic sizing: shrink text if it doesn't fit, keep within 40% header
        function fitTextToContainer() {
            document.querySelectorAll('.market-sign-preview').forEach(card => {
                const headerArea = card.querySelector('.header-area');
                const itemName = card.querySelector('.item-name');
                const variety = card.querySelector('.variety');
                if (!headerArea || !itemName) return;

                const containerWidth = headerArea.clientWidth * 0.94;  // Leave small margin
                const containerHeight = headerArea.clientHeight;
                const words = itemName.querySelectorAll('.crop-word');

                // Reset to default size first
                words.forEach(word => {
                    word.style.fontSize = '38px';
                });
                if (variety) {
                    variety.style.fontSize = '16px';
                }

                // Shrink each word if it exceeds container width
                words.forEach(word => {
                    let fontSize = 38;
                    while (word.scrollWidth > containerWidth && fontSize > 12) {
                        fontSize -= 2;
                        word.style.fontSize = fontSize + 'px';
                    }
                });

                // Check if total height exceeds container, shrink all proportionally
                const varietyHeight = variety ? variety.offsetHeight + 8 : 0;
                let totalHeight = itemName.offsetHeight + varietyHeight;

                if (totalHeight > containerHeight - 5) {
                    const scale = (containerHeight - 10) / totalHeight;

                    words.forEach(word => {
                        const currentSize = parseFloat(word.style.fontSize);
                        word.style.fontSize = Math.max(12, currentSize * scale) + 'px';
                    });

                    if (variety) {
                        const currentVarSize = parseFloat(variety.style.fontSize);
                        variety.style.fontSize = Math.max(10, currentVarSize * scale) + 'px';
                    }
                }
            });
        }

        // Format unit for display - "EACH" stays as-is, others get "PER" prefix
        function formatUnitDisplay(unit) {
            const unitClean = (unit || '/each').replace('/', '').toUpperCase().trim();
            if (unitClean === 'EACH' || unitClean === 'EA') {
                return 'EACH';
            }
            return `PER ${unitClean}`;
        }

        function renderMarketSigns() {
            const grid = document.getElementById('marketSignsGrid');

            if (AppState.marketSigns.length === 0) {
                grid.innerHTML = `
                    <div class="empty-state">
                        <div class="empty-state-icon">ğŸ·ï¸</div>
                        <p>No market items found. Add items manually below.</p>
                    </div>
                `;
                return;
            }

            grid.innerHTML = AppState.marketSigns.map((item, idx) => {
                const priceStr = String(Math.floor(item.price));
                const cropNameHTML = formatCropName(item.name);
                const category = getCategoryClass(item.category || item.name);
                const unitDisplay = formatUnitDisplay(item.unit);

                return `
                    <div class="market-sign-preview ${category} ${AppState.selectedMarket.has(idx) ? 'selected' : ''}"
                         onclick="toggleSelection('market', ${idx})">
                        <div class="sign-content">
                            <div class="header-area">
                                <div class="item-name">${cropNameHTML}</div>
                                ${item.variety ? `<div class="variety">${item.variety}</div>` : ''}
                            </div>
                            <div class="price-section">
                                <div class="price-wrapper">
                                    <span class="price-number">${priceStr}</span>
                                    <span class="unit-badge">${unitDisplay}</span>
                                </div>
                            </div>
                        </div>
                        <div class="sign-footer">
                            <span class="tagline">FRESH. LOCAL. ORGANIC.</span>
                            <img src="${LOGO_PATH}" alt="TSF" class="logo-img" onerror="this.outerHTML='<span class=\\'logo-text\\'>TSF</span>'">
                        </div>
                    </div>
                `;
            }).join('');

            // Apply dynamic sizing after render
            setTimeout(fitTextToContainer, 10);
        }

        function renderCSALabels() {
            const grid = document.getElementById('csaLabelsGrid');

            if (AppState.csaLabels.length === 0) {
                grid.innerHTML = `
                    <div class="empty-state">
                        <div class="empty-state-icon">ğŸ“¦</div>
                        <p>No CSA orders found for this date.</p>
                    </div>
                `;
                return;
            }

            grid.innerHTML = AppState.csaLabels.map((order, idx) => `
                <div class="label-preview ${AppState.selectedCSA.has(idx) ? 'selected' : ''}"
                     onclick="toggleSelection('csa', ${idx})">
                    <div class="customer-name">${order.customerName}</div>
                    <ul class="items-list">
                        ${order.items.map(item => `
                            <li>${item.quantity} ${item.unit} - ${item.productName}</li>
                        `).join('')}
                    </ul>
                </div>
            `).join('');
        }

        function renderWholesaleLabels() {
            const grid = document.getElementById('wholesaleLabelsGrid');

            if (AppState.wholesaleLabels.length === 0) {
                grid.innerHTML = `
                    <div class="empty-state">
                        <div class="empty-state-icon">ğŸª</div>
                        <p>No wholesale orders found for this date.</p>
                    </div>
                `;
                return;
            }

            grid.innerHTML = AppState.wholesaleLabels.map((order, idx) => `
                <div class="label-preview ${AppState.selectedWholesale.has(idx) ? 'selected' : ''}"
                     onclick="toggleSelection('wholesale', ${idx})">
                    <div class="customer-name">${order.customerName}</div>
                    <ul class="items-list">
                        ${order.items.map(item => `
                            <li>${item.quantity} ${item.unit} - ${item.productName}</li>
                        `).join('')}
                    </ul>
                </div>
            `).join('');
        }

        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        // SELECTION MANAGEMENT
        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

        function toggleSelection(type, idx) {
            const selectedSet = type === 'market' ? AppState.selectedMarket :
                               type === 'csa' ? AppState.selectedCSA :
                               AppState.selectedWholesale;

            if (selectedSet.has(idx)) {
                selectedSet.delete(idx);
            } else {
                selectedSet.add(idx);
            }

            // Re-render to update selection state
            if (type === 'market') renderMarketSigns();
            else if (type === 'csa') renderCSALabels();
            else renderWholesaleLabels();

            updateStats();
        }

        function toggleSelectAll(type) {
            const checkbox = document.getElementById(`selectAll${type.charAt(0).toUpperCase() + type.slice(1)}`);
            const items = type === 'market' ? AppState.marketSigns :
                         type === 'csa' ? AppState.csaLabels :
                         AppState.wholesaleLabels;
            const selectedSet = type === 'market' ? AppState.selectedMarket :
                               type === 'csa' ? AppState.selectedCSA :
                               AppState.selectedWholesale;

            if (checkbox.checked) {
                items.forEach((_, idx) => selectedSet.add(idx));
            } else {
                selectedSet.clear();
            }

            if (type === 'market') renderMarketSigns();
            else if (type === 'csa') renderCSALabels();
            else renderWholesaleLabels();

            updateStats();
        }

        function updateStats() {
            const totalMap = {
                market: AppState.marketSigns.length,
                csa: AppState.csaLabels.length,
                wholesale: AppState.wholesaleLabels.length
            };

            const selectedMap = {
                market: AppState.selectedMarket.size,
                csa: AppState.selectedCSA.size,
                wholesale: AppState.selectedWholesale.size
            };

            document.getElementById('totalLabels').textContent = totalMap[AppState.currentTab];
            document.getElementById('selectedLabels').textContent = selectedMap[AppState.currentTab];
        }

        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        // MANUAL ENTRY
        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

        function addManualMarketSign() {
            const name = document.getElementById('manualItemName').value.trim();
            const variety = document.getElementById('manualVariety').value.trim();
            const price = parseFloat(document.getElementById('manualPrice').value);
            const unit = document.getElementById('manualUnit').value.trim() || '/each';

            if (!name || isNaN(price)) {
                alert('Please enter at least an item name and price.');
                return;
            }

            const newItem = {
                id: Date.now(),
                name: name,
                variety: variety || '',
                price: price,
                unit: unit
            };

            AppState.marketSigns.push(newItem);
            renderMarketSigns();
            updateStats();

            // Clear form
            document.getElementById('manualItemName').value = '';
            document.getElementById('manualVariety').value = '';
            document.getElementById('manualPrice').value = '';
            document.getElementById('manualUnit').value = '';
        }

        function addManualCSALabel() {
            const customerName = document.getElementById('manualCSACustomer').value.trim();
            const itemsStr = document.getElementById('manualCSAItems').value.trim();

            if (!customerName) {
                alert('Please enter a customer name.');
                return;
            }

            // Parse items (comma separated)
            const items = itemsStr ? itemsStr.split(',').map(item => ({
                quantity: 1,
                unit: '',
                productName: item.trim()
            })) : [];

            const newLabel = {
                id: Date.now(),
                customerName: customerName,
                items: items
            };

            AppState.csaLabels.push(newLabel);
            renderCSALabels();
            updateStats();

            // Clear form
            document.getElementById('manualCSACustomer').value = '';
            document.getElementById('manualCSAItems').value = '';
        }

        function addManualWholesaleLabel() {
            const customerName = document.getElementById('manualWholesaleCustomer').value.trim();
            const product = document.getElementById('manualWholesaleProduct').value.trim();
            const quantity = document.getElementById('manualWholesaleQty').value.trim();
            const lotNumber = document.getElementById('manualWholesaleLot').value.trim();

            if (!customerName || !product) {
                alert('Please enter at least a customer name and product.');
                return;
            }

            const newLabel = {
                id: Date.now(),
                customerName: customerName,
                productName: product,
                quantity: quantity || '1',
                lotNumber: lotNumber || '',
                harvestDate: new Date().toLocaleDateString()
            };

            AppState.wholesaleLabels.push(newLabel);
            renderWholesaleLabels();
            updateStats();

            // Clear form
            document.getElementById('manualWholesaleCustomer').value = '';
            document.getElementById('manualWholesaleProduct').value = '';
            document.getElementById('manualWholesaleQty').value = '';
            document.getElementById('manualWholesaleLot').value = '';
        }

        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        // PRINTING
        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

        function printSelected() {
            const tab = AppState.currentTab;

            if (tab === 'market') {
                printMarketSigns();
            } else if (tab === 'csa') {
                printCSALabels();
            } else {
                printWholesaleLabels();
            }
        }

        function printMarketSigns() {
            const selected = AppState.selectedMarket.size > 0
                ? [...AppState.selectedMarket].map(idx => AppState.marketSigns[idx])
                : AppState.marketSigns;

            if (selected.length === 0) {
                alert('No market signs to print.');
                return;
            }

            const container = document.getElementById('printMarketSigns');

            container.innerHTML = selected.map(item => {
                const priceStr = String(Math.floor(item.price));
                const cropNameHTML = formatCropName(item.name);
                const isSingleDigit = priceStr.length === 1;

                // Determine category for footer color
                const category = getCategoryClass(item.category || item.name);

                // Format unit for display
                const unitDisplay = formatUnitDisplay(item.unit);

                return `
                    <div class="market-sign-print ${category}">
                        <div class="sign-content">
                            <div class="header-area">
                                <div class="item-name">${cropNameHTML}</div>
                                ${item.variety ? `<div class="variety">${item.variety}</div>` : ''}
                            </div>
                            <div class="price-section">
                                <div class="price-wrapper">
                                    <span class="price-number ${isSingleDigit ? 'single-digit' : 'double-digit'}">${priceStr}</span>
                                    <span class="unit-badge">${unitDisplay}</span>
                                </div>
                            </div>
                        </div>
                        <div class="sign-footer">
                            <span class="tagline">FRESH. LOCAL. ORGANIC.</span>
                            <div class="logo-area">
                                <img src="${LOGO_PATH}" alt="Tiny Seed Farm" class="logo-img" onerror="this.style.display='none';this.nextElementSibling.style.display='block';">
                                <span class="logo-text" style="display:none;">TSF</span>
                            </div>
                        </div>
                    </div>
                `;
            }).join('');

            window.print();
        }

        // Determine category class based on item category or name
        function getCategoryClass(categoryOrName) {
            const lower = (categoryOrName || '').toLowerCase();

            // Floral products
            if (lower.includes('flower') || lower.includes('floral') || lower.includes('bouquet') ||
                lower.includes('dahlia') || lower.includes('zinnia') || lower.includes('sunflower') ||
                lower.includes('rose') || lower.includes('peony') || lower.includes('tulip')) {
                return 'category-floral';
            }

            // Mushroom products
            if (lower.includes('mushroom') || lower.includes('shiitake') || lower.includes('oyster') ||
                lower.includes('lion') || lower.includes('maitake') || lower.includes('chanterelle')) {
                return 'category-mushroom';
            }

            // Default: vegetables (green)
            return '';
        }

        function printCSALabels() {
            const selected = AppState.selectedCSA.size > 0
                ? [...AppState.selectedCSA].map(idx => AppState.csaLabels[idx])
                : AppState.csaLabels;

            if (selected.length === 0) {
                alert('No CSA labels to print.');
                return;
            }

            const container = document.getElementById('printCSALabels');

            container.innerHTML = selected.map(order => `
                <div class="csa-label-print">
                    <div class="label-header">${FARM_NAME} - CSA Share</div>
                    <div class="customer-name">${order.customerName}</div>
                    <ul class="items-list">
                        ${order.items.map(item => `
                            <li>${item.quantity} ${item.unit} ${item.productName}</li>
                        `).join('')}
                    </ul>
                </div>
            `).join('');

            window.print();
        }

        function printWholesaleLabels() {
            const selected = AppState.selectedWholesale.size > 0
                ? [...AppState.selectedWholesale].map(idx => AppState.wholesaleLabels[idx])
                : AppState.wholesaleLabels;

            if (selected.length === 0) {
                alert('No wholesale labels to print.');
                return;
            }

            const container = document.getElementById('printWholesaleLabels');

            container.innerHTML = selected.map(order => `
                <div class="wholesale-label-print">
                    <div class="customer-name">${order.customerName}</div>
                    <ul class="items-list">
                        ${order.items.map(item => `
                            <li>
                                <span>${item.productName}</span>
                                <span>${item.quantity} ${item.unit}</span>
                            </li>
                        `).join('')}
                    </ul>
                </div>
            `).join('');

            window.print();
        }

        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        // UTILITIES
        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

        function showError(message) {
            // Could be enhanced with toast notifications
            console.error(message);
            alert(message);
        }

        function filterLabels() {
            // Filter by customer type if needed
            const type = document.getElementById('customerType').value;
            // This would filter the displayed labels
            // For now, re-render with current data
            if (AppState.currentTab === 'csa') renderCSALabels();
            else if (AppState.currentTab === 'wholesale') renderWholesaleLabels();
        }
    </script>
</body>
</html>
