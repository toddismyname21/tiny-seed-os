<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Farm Inventory Capture</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        :root {
            --primary: #2d5a27;
            --primary-light: #4a7c43;
            --success: #2a9d8f;
            --warning: #e9c46a;
            --danger: #e63946;
            --bg-dark: #1a1a2e;
            --bg-card: #16213e;
            --bg-light: #0f3460;
            --text-primary: #edf2f4;
            --text-secondary: #8d99ae;
            --border: rgba(255,255,255,0.1);
        }

        * { margin: 0; padding: 0; box-sizing: border-box; }

        body {
            font-family: 'Inter', sans-serif;
            background: var(--bg-dark);
            color: var(--text-primary);
            min-height: 100vh;
            overflow-x: hidden;
        }

        /* Header */
        .header {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            height: 56px;
            background: var(--bg-card);
            border-bottom: 1px solid var(--border);
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 0 1rem;
            z-index: 100;
        }

        .header-title {
            font-size: 1.1rem;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .header-title i {
            color: var(--primary-light);
        }

        .stats-badge {
            background: var(--primary);
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 0.85rem;
            font-weight: 600;
        }

        /* Main Content */
        .main-content {
            padding-top: 56px;
            padding-bottom: 80px;
            min-height: 100vh;
        }

        /* Home Screen */
        .home-screen {
            padding: 1.5rem;
            display: flex;
            flex-direction: column;
            gap: 1.5rem;
        }

        .add-btn-large {
            background: linear-gradient(135deg, var(--primary), var(--primary-light));
            border: none;
            border-radius: 16px;
            padding: 2rem;
            color: white;
            font-size: 1.2rem;
            font-weight: 600;
            cursor: pointer;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 12px;
            transition: transform 0.2s, box-shadow 0.2s;
            box-shadow: 0 4px 20px rgba(45, 90, 39, 0.3);
        }

        .add-btn-large:active {
            transform: scale(0.98);
        }

        .add-btn-large i {
            font-size: 3rem;
        }

        /* Progress Card */
        .progress-card {
            background: var(--bg-card);
            border-radius: 12px;
            padding: 1.25rem;
        }

        .progress-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 12px;
        }

        .progress-title {
            font-weight: 600;
            color: var(--text-secondary);
        }

        .progress-count {
            font-size: 1.5rem;
            font-weight: 700;
            color: var(--primary-light);
        }

        .progress-bar {
            height: 8px;
            background: var(--bg-light);
            border-radius: 4px;
            overflow: hidden;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, var(--primary), var(--success));
            border-radius: 4px;
            transition: width 0.3s;
        }

        /* Quick Actions */
        .quick-actions {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 12px;
        }

        .quick-action {
            background: var(--bg-card);
            border: none;
            border-radius: 12px;
            padding: 1rem;
            color: var(--text-primary);
            font-size: 0.9rem;
            font-weight: 500;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 10px;
            transition: background 0.2s;
        }

        .quick-action:active {
            background: var(--bg-light);
        }

        .quick-action i {
            color: var(--primary-light);
            font-size: 1.1rem;
        }

        /* Recent Items */
        .recent-section {
            background: var(--bg-card);
            border-radius: 12px;
            overflow: hidden;
        }

        .section-header {
            padding: 1rem 1.25rem;
            font-weight: 600;
            border-bottom: 1px solid var(--border);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .recent-list {
            max-height: 300px;
            overflow-y: auto;
        }

        .recent-item {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 12px 1.25rem;
            border-bottom: 1px solid var(--border);
        }

        .recent-item:last-child {
            border-bottom: none;
        }

        .recent-thumb {
            width: 50px;
            height: 50px;
            border-radius: 8px;
            background: var(--bg-light);
            display: flex;
            align-items: center;
            justify-content: center;
            overflow: hidden;
        }

        .recent-thumb img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .recent-thumb i {
            color: var(--text-secondary);
            font-size: 1.2rem;
        }

        .recent-info {
            flex: 1;
        }

        .recent-name {
            font-weight: 500;
            margin-bottom: 2px;
        }

        .recent-meta {
            font-size: 0.8rem;
            color: var(--text-secondary);
        }

        /* Add Item Form Screen */
        .form-screen {
            display: none;
            padding: 1rem;
        }

        .form-screen.active {
            display: block;
        }

        .home-screen.hidden {
            display: none;
        }

        /* Back Button */
        .back-btn {
            background: none;
            border: none;
            color: var(--text-primary);
            font-size: 1.2rem;
            cursor: pointer;
            padding: 8px;
            margin: -8px;
        }

        /* Photo Capture */
        .photo-capture {
            background: var(--bg-card);
            border-radius: 12px;
            padding: 1.5rem;
            margin-bottom: 1rem;
            text-align: center;
        }

        .photo-preview {
            width: 100%;
            aspect-ratio: 4/3;
            background: var(--bg-light);
            border-radius: 12px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            gap: 12px;
            cursor: pointer;
            border: 2px dashed var(--border);
            transition: border-color 0.2s;
            overflow: hidden;
        }

        .photo-preview:active {
            border-color: var(--primary-light);
        }

        .photo-preview.has-photo {
            border: none;
        }

        .photo-preview img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .photo-preview i {
            font-size: 3rem;
            color: var(--text-secondary);
        }

        .photo-preview span {
            color: var(--text-secondary);
            font-size: 0.9rem;
        }

        .photo-actions {
            display: flex;
            gap: 12px;
            margin-top: 12px;
        }

        .photo-action-btn {
            flex: 1;
            padding: 12px;
            border: none;
            border-radius: 8px;
            font-size: 0.9rem;
            font-weight: 500;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }

        .photo-action-btn.camera {
            background: var(--primary);
            color: white;
        }

        .photo-action-btn.gallery {
            background: var(--bg-light);
            color: var(--text-primary);
        }

        /* Form Fields */
        .form-card {
            background: var(--bg-card);
            border-radius: 12px;
            padding: 1.25rem;
            margin-bottom: 1rem;
        }

        .form-group {
            margin-bottom: 1rem;
        }

        .form-group:last-child {
            margin-bottom: 0;
        }

        .form-label {
            display: block;
            font-size: 0.85rem;
            font-weight: 500;
            color: var(--text-secondary);
            margin-bottom: 6px;
        }

        .form-label.required::after {
            content: ' *';
            color: var(--danger);
        }

        .form-input, .form-select, .form-textarea {
            width: 100%;
            padding: 12px;
            background: var(--bg-light);
            border: 1px solid var(--border);
            border-radius: 8px;
            color: var(--text-primary);
            font-size: 1rem;
            font-family: inherit;
        }

        .form-input:focus, .form-select:focus, .form-textarea:focus {
            outline: none;
            border-color: var(--primary-light);
        }

        .form-textarea {
            min-height: 80px;
            resize: vertical;
        }

        .form-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 12px;
        }

        /* Condition Radio Buttons */
        .condition-options {
            display: flex;
            gap: 8px;
            flex-wrap: wrap;
        }

        .condition-option {
            flex: 1;
            min-width: calc(50% - 4px);
        }

        .condition-option input {
            display: none;
        }

        .condition-option label {
            display: block;
            padding: 10px;
            background: var(--bg-light);
            border: 2px solid transparent;
            border-radius: 8px;
            text-align: center;
            font-size: 0.85rem;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s;
        }

        .condition-option input:checked + label {
            border-color: var(--primary-light);
            background: rgba(45, 90, 39, 0.2);
        }

        .condition-option.good label { color: var(--success); }
        .condition-option.fair label { color: var(--warning); }
        .condition-option.poor label { color: #f4a261; }
        .condition-option.repair label { color: var(--danger); }

        /* Submit Button */
        .submit-btn {
            width: 100%;
            padding: 16px;
            background: linear-gradient(135deg, var(--primary), var(--primary-light));
            border: none;
            border-radius: 12px;
            color: white;
            font-size: 1.1rem;
            font-weight: 600;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            margin-top: 1rem;
            transition: transform 0.2s;
        }

        .submit-btn:active {
            transform: scale(0.98);
        }

        .submit-btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
        }

        /* Success Modal */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0,0,0,0.7);
            display: none;
            align-items: center;
            justify-content: center;
            z-index: 1000;
            padding: 1rem;
        }

        .modal-overlay.active {
            display: flex;
        }

        .modal {
            background: var(--bg-card);
            border-radius: 16px;
            padding: 2rem;
            text-align: center;
            max-width: 320px;
            width: 100%;
        }

        .modal-icon {
            width: 80px;
            height: 80px;
            background: rgba(42, 157, 143, 0.2);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 0 auto 1rem;
        }

        .modal-icon i {
            font-size: 2.5rem;
            color: var(--success);
        }

        .modal-title {
            font-size: 1.3rem;
            font-weight: 700;
            margin-bottom: 8px;
        }

        .modal-text {
            color: var(--text-secondary);
            margin-bottom: 1.5rem;
        }

        .modal-btn {
            width: 100%;
            padding: 14px;
            border: none;
            border-radius: 10px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            margin-bottom: 10px;
        }

        .modal-btn.primary {
            background: var(--primary);
            color: white;
        }

        .modal-btn.secondary {
            background: var(--bg-light);
            color: var(--text-primary);
        }

        /* Loading Spinner */
        .loading {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0,0,0,0.7);
            align-items: center;
            justify-content: center;
            z-index: 2000;
        }

        .loading.active {
            display: flex;
        }

        .spinner {
            width: 50px;
            height: 50px;
            border: 4px solid var(--border);
            border-top-color: var(--primary-light);
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        /* List View Screen */
        .list-screen {
            display: none;
            padding: 1rem;
        }

        .list-screen.active {
            display: block;
        }

        .filter-bar {
            display: flex;
            gap: 8px;
            margin-bottom: 1rem;
            overflow-x: auto;
            padding-bottom: 8px;
        }

        .filter-chip {
            padding: 8px 16px;
            background: var(--bg-card);
            border: none;
            border-radius: 20px;
            color: var(--text-secondary);
            font-size: 0.85rem;
            white-space: nowrap;
            cursor: pointer;
        }

        .filter-chip.active {
            background: var(--primary);
            color: white;
        }

        .inventory-list {
            display: flex;
            flex-direction: column;
            gap: 12px;
        }

        .inventory-item {
            background: var(--bg-card);
            border-radius: 12px;
            padding: 1rem;
            display: flex;
            gap: 12px;
        }

        .item-photo {
            width: 70px;
            height: 70px;
            border-radius: 8px;
            background: var(--bg-light);
            overflow: hidden;
            flex-shrink: 0;
        }

        .item-photo img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .item-photo i {
            width: 100%;
            height: 100%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: var(--text-secondary);
        }

        .item-details {
            flex: 1;
            min-width: 0;
        }

        .item-name {
            font-weight: 600;
            margin-bottom: 4px;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .item-meta {
            font-size: 0.8rem;
            color: var(--text-secondary);
            margin-bottom: 2px;
        }

        .item-value {
            font-weight: 600;
            color: var(--success);
        }

        /* Bottom Nav */
        .bottom-nav {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            height: 64px;
            background: var(--bg-card);
            border-top: 1px solid var(--border);
            display: flex;
            z-index: 100;
            padding-bottom: env(safe-area-inset-bottom, 0);
        }

        .nav-item {
            flex: 1;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            gap: 4px;
            background: none;
            border: none;
            color: var(--text-secondary);
            font-size: 0.7rem;
            cursor: pointer;
        }

        .nav-item.active {
            color: var(--primary-light);
        }

        .nav-item i {
            font-size: 1.2rem;
        }

        /* Hidden file input */
        #cameraInput, #galleryInput {
            display: none;
        }

        /* Toast Notification */
        .toast {
            position: fixed;
            bottom: 80px;
            left: 50%;
            transform: translateX(-50%);
            background: var(--bg-card);
            color: var(--text-primary);
            padding: 12px 24px;
            border-radius: 8px;
            font-size: 0.9rem;
            box-shadow: 0 4px 20px rgba(0,0,0,0.3);
            display: none;
            z-index: 500;
        }

        .toast.show {
            display: block;
            animation: slideUp 0.3s ease;
        }

        @keyframes slideUp {
            from {
                opacity: 0;
                transform: translateX(-50%) translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateX(-50%) translateY(0);
            }
        }

        /* Stats Screen */
        .stats-screen {
            display: none;
            padding: 1rem;
        }

        .stats-screen.active {
            display: block;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 12px;
            margin-bottom: 1rem;
        }

        .stat-card {
            background: var(--bg-card);
            border-radius: 12px;
            padding: 1rem;
        }

        .stat-label {
            font-size: 0.8rem;
            color: var(--text-secondary);
            margin-bottom: 4px;
        }

        .stat-value {
            font-size: 1.5rem;
            font-weight: 700;
            color: var(--primary-light);
        }

        .stat-value.money {
            color: var(--success);
        }

        /* Smart Dashboard Styles */
        .smart-screen {
            display: none;
            padding: 1rem;
        }

        .smart-screen.active {
            display: block;
        }

        /* Health Score Card */
        .health-card {
            background: linear-gradient(135deg, var(--bg-card), var(--bg-light));
            border-radius: 16px;
            padding: 1.5rem;
            margin-bottom: 1rem;
            text-align: center;
        }

        .health-score-ring {
            position: relative;
            width: 120px;
            height: 120px;
            margin: 0 auto 1rem;
        }

        .health-score-bg {
            fill: none;
            stroke: var(--border);
            stroke-width: 10;
        }

        .health-score-fill {
            fill: none;
            stroke-width: 10;
            stroke-linecap: round;
            transform: rotate(-90deg);
            transform-origin: center;
            transition: stroke-dasharray 0.5s ease;
        }

        .health-score-fill.excellent { stroke: var(--success); }
        .health-score-fill.good { stroke: #82c91e; }
        .health-score-fill.fair { stroke: var(--warning); }
        .health-score-fill.poor { stroke: var(--danger); }

        .health-score-text {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            text-align: center;
        }

        .health-score-value {
            font-size: 2rem;
            font-weight: 700;
            color: var(--text-primary);
        }

        .health-score-label {
            font-size: 0.75rem;
            color: var(--text-secondary);
            text-transform: uppercase;
        }

        .health-summary {
            display: flex;
            justify-content: space-around;
            padding-top: 1rem;
            border-top: 1px solid var(--border);
            margin-top: 1rem;
        }

        .health-stat {
            text-align: center;
        }

        .health-stat-value {
            font-size: 1.25rem;
            font-weight: 700;
        }

        .health-stat-value.good { color: var(--success); }
        .health-stat-value.warning { color: var(--warning); }
        .health-stat-value.danger { color: var(--danger); }

        .health-stat-label {
            font-size: 0.7rem;
            color: var(--text-secondary);
        }

        /* Actions Card */
        .actions-card {
            background: var(--bg-card);
            border-radius: 12px;
            margin-bottom: 1rem;
            overflow: hidden;
        }

        .actions-header {
            padding: 1rem;
            background: var(--bg-light);
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .actions-header i {
            font-size: 1.1rem;
        }

        .actions-header.critical { color: var(--danger); }
        .actions-header.high { color: #f4a261; }
        .actions-header.medium { color: var(--warning); }
        .actions-header.info { color: var(--success); }

        .action-item {
            padding: 1rem;
            border-bottom: 1px solid var(--border);
            display: flex;
            align-items: flex-start;
            gap: 12px;
        }

        .action-item:last-child {
            border-bottom: none;
        }

        .action-icon {
            width: 36px;
            height: 36px;
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            flex-shrink: 0;
        }

        .action-icon.critical { background: rgba(230, 57, 70, 0.2); color: var(--danger); }
        .action-icon.high { background: rgba(244, 162, 97, 0.2); color: #f4a261; }
        .action-icon.medium { background: rgba(233, 196, 106, 0.2); color: var(--warning); }
        .action-icon.low { background: rgba(42, 157, 143, 0.2); color: var(--success); }

        .action-content {
            flex: 1;
            min-width: 0;
        }

        .action-title {
            font-weight: 500;
            margin-bottom: 4px;
        }

        .action-meta {
            font-size: 0.8rem;
            color: var(--text-secondary);
        }

        .action-btn {
            padding: 6px 12px;
            background: var(--bg-light);
            border: none;
            border-radius: 6px;
            color: var(--primary-light);
            font-size: 0.8rem;
            font-weight: 500;
            cursor: pointer;
        }

        /* At Risk Equipment */
        .risk-item {
            padding: 1rem;
            border-bottom: 1px solid var(--border);
        }

        .risk-item:last-child {
            border-bottom: none;
        }

        .risk-item-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 8px;
        }

        .risk-item-name {
            font-weight: 500;
        }

        .risk-score {
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 0.75rem;
            font-weight: 600;
        }

        .risk-score.high { background: rgba(230, 57, 70, 0.2); color: var(--danger); }
        .risk-score.medium { background: rgba(244, 162, 97, 0.2); color: #f4a261; }
        .risk-score.low { background: rgba(233, 196, 106, 0.2); color: var(--warning); }

        .risk-bar {
            height: 6px;
            background: var(--border);
            border-radius: 3px;
            overflow: hidden;
            margin-bottom: 6px;
        }

        .risk-bar-fill {
            height: 100%;
            border-radius: 3px;
            transition: width 0.3s;
        }

        .risk-bar-fill.high { background: var(--danger); }
        .risk-bar-fill.medium { background: #f4a261; }
        .risk-bar-fill.low { background: var(--warning); }

        .risk-item-meta {
            font-size: 0.8rem;
            color: var(--text-secondary);
        }

        /* Seasonal Readiness */
        .readiness-item {
            padding: 12px 1rem;
            border-bottom: 1px solid var(--border);
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .readiness-item:last-child {
            border-bottom: none;
        }

        .readiness-icon {
            font-size: 1rem;
        }

        .readiness-icon.ready { color: var(--success); }
        .readiness-icon.warning { color: var(--warning); }
        .readiness-icon.action { color: var(--danger); }

        .readiness-text {
            flex: 1;
            font-size: 0.9rem;
        }

        /* Forecast Card */
        .forecast-card {
            background: var(--bg-card);
            border-radius: 12px;
            padding: 1rem;
            margin-bottom: 1rem;
        }

        .forecast-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1rem;
        }

        .forecast-title {
            font-weight: 600;
        }

        .forecast-total {
            font-size: 1.25rem;
            font-weight: 700;
            color: var(--success);
        }

        .forecast-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 10px 0;
            border-bottom: 1px solid var(--border);
        }

        .forecast-item:last-child {
            border-bottom: none;
        }

        .forecast-item-name {
            font-size: 0.9rem;
        }

        .forecast-item-detail {
            font-size: 0.75rem;
            color: var(--text-secondary);
        }

        .forecast-item-cost {
            font-weight: 600;
            color: var(--primary-light);
        }

        /* Empty state */
        .empty-state {
            padding: 2rem;
            text-align: center;
            color: var(--text-secondary);
        }

        .empty-state i {
            font-size: 3rem;
            margin-bottom: 1rem;
            opacity: 0.5;
        }

        /* Pulse animation for critical items */
        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.6; }
        }

        .pulse {
            animation: pulse 2s infinite;
        }
    </style>
</head>
<body>
    <!-- Header -->
    <header class="header">
        <div class="header-title">
            <i class="fas fa-warehouse"></i>
            Farm Inventory
        </div>
        <div class="stats-badge" id="itemCount">0 items</div>
    </header>

    <!-- Main Content -->
    <main class="main-content">
        <!-- Home Screen -->
        <div class="home-screen" id="homeScreen">
            <button class="add-btn-large" onclick="showAddForm()">
                <i class="fas fa-camera"></i>
                Add New Item
            </button>

            <div class="progress-card">
                <div class="progress-header">
                    <span class="progress-title">Today's Progress</span>
                    <span class="progress-count" id="todayCount">0</span>
                </div>
                <div class="progress-bar">
                    <div class="progress-fill" id="progressFill" style="width: 0%"></div>
                </div>
            </div>

            <div class="quick-actions">
                <button class="quick-action" onclick="showList()">
                    <i class="fas fa-list"></i>
                    View All
                </button>
                <button class="quick-action" onclick="showStats()">
                    <i class="fas fa-chart-pie"></i>
                    Statistics
                </button>
                <button class="quick-action" onclick="filterByCondition('Needs Repair')">
                    <i class="fas fa-wrench"></i>
                    Needs Repair
                </button>
                <button class="quick-action" onclick="refreshData()">
                    <i class="fas fa-sync"></i>
                    Refresh
                </button>
            </div>

            <div class="recent-section">
                <div class="section-header">
                    <span>Recently Added</span>
                    <small id="lastSync"></small>
                </div>
                <div class="recent-list" id="recentList">
                    <div class="recent-item" style="justify-content: center; color: var(--text-secondary);">
                        No items yet. Start adding!
                    </div>
                </div>
            </div>
        </div>

        <!-- Add Item Form -->
        <div class="form-screen" id="formScreen">
            <!-- Photo Section -->
            <div class="photo-capture">
                <div class="photo-preview" id="photoPreview" onclick="document.getElementById('cameraInput').click()">
                    <i class="fas fa-camera"></i>
                    <span>Tap to take photo</span>
                </div>
                <div class="photo-actions">
                    <button class="photo-action-btn camera" onclick="event.stopPropagation(); document.getElementById('cameraInput').click()">
                        <i class="fas fa-camera"></i> Camera
                    </button>
                    <button class="photo-action-btn gallery" onclick="event.stopPropagation(); document.getElementById('galleryInput').click()">
                        <i class="fas fa-image"></i> Gallery
                    </button>
                </div>
            </div>

            <!-- Form Fields -->
            <div class="form-card">
                <div class="form-group">
                    <label class="form-label required">Item Name</label>
                    <input type="text" class="form-input" id="itemName" placeholder="What is this item?">
                </div>

                <div class="form-row">
                    <div class="form-group">
                        <label class="form-label required">Category</label>
                        <select class="form-select" id="category">
                            <option value="">Select...</option>
                            <option value="Equipment">Equipment</option>
                            <option value="Tools">Tools</option>
                            <option value="Seeds & Transplants">Seeds & Transplants</option>
                            <option value="Irrigation">Irrigation</option>
                            <option value="Pest Control">Pest Control</option>
                            <option value="Soil Amendments">Soil Amendments</option>
                            <option value="Packaging">Packaging</option>
                            <option value="Safety">Safety</option>
                            <option value="Office">Office</option>
                            <option value="Infrastructure">Infrastructure</option>
                            <option value="Vehicles">Vehicles</option>
                            <option value="Other">Other</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label class="form-label required">Quantity</label>
                        <input type="number" class="form-input" id="quantity" value="1" min="1">
                    </div>
                </div>

                <div class="form-group">
                    <label class="form-label required">Condition</label>
                    <div class="condition-options">
                        <div class="condition-option good">
                            <input type="radio" name="condition" id="condGood" value="Good" checked>
                            <label for="condGood">Good</label>
                        </div>
                        <div class="condition-option fair">
                            <input type="radio" name="condition" id="condFair" value="Fair">
                            <label for="condFair">Fair</label>
                        </div>
                        <div class="condition-option poor">
                            <input type="radio" name="condition" id="condPoor" value="Poor">
                            <label for="condPoor">Poor</label>
                        </div>
                        <div class="condition-option repair">
                            <input type="radio" name="condition" id="condRepair" value="Needs Repair">
                            <label for="condRepair">Needs Repair</label>
                        </div>
                    </div>
                </div>

                <div class="form-group">
                    <label class="form-label required">Location</label>
                    <select class="form-select" id="location">
                        <option value="">Select...</option>
                        <option value="Tool Shed">Tool Shed</option>
                        <option value="Greenhouse 1">Greenhouse 1</option>
                        <option value="Greenhouse 2">Greenhouse 2</option>
                        <option value="Greenhouse 3">Greenhouse 3</option>
                        <option value="Equipment Barn">Equipment Barn</option>
                        <option value="Cold Storage">Cold Storage</option>
                        <option value="Wash/Pack Station">Wash/Pack Station</option>
                        <option value="Field Storage">Field Storage</option>
                        <option value="Office">Office</option>
                        <option value="Personal Vehicle">Personal Vehicle</option>
                        <option value="Other">Other</option>
                    </select>
                </div>
            </div>

            <div class="form-card">
                <div class="form-row">
                    <div class="form-group">
                        <label class="form-label">Est. Value ($)</label>
                        <input type="number" class="form-input" id="estValue" placeholder="0">
                    </div>
                    <div class="form-group">
                        <label class="form-label">Serial/Model</label>
                        <input type="text" class="form-input" id="serialModel" placeholder="Optional">
                    </div>
                </div>

                <div class="form-group">
                    <label class="form-label">Notes</label>
                    <textarea class="form-textarea" id="notes" placeholder="Any additional details..."></textarea>
                </div>
            </div>

            <button class="submit-btn" onclick="submitItem()" id="submitBtn">
                <i class="fas fa-check"></i>
                Save Item
            </button>
        </div>

        <!-- List Screen -->
        <div class="list-screen" id="listScreen">
            <div class="filter-bar" id="filterBar">
                <button class="filter-chip active" data-filter="all" onclick="filterItems('all')">All</button>
                <button class="filter-chip" data-filter="Equipment" onclick="filterItems('Equipment')">Equipment</button>
                <button class="filter-chip" data-filter="Tools" onclick="filterItems('Tools')">Tools</button>
                <button class="filter-chip" data-filter="Irrigation" onclick="filterItems('Irrigation')">Irrigation</button>
                <button class="filter-chip" data-filter="Vehicles" onclick="filterItems('Vehicles')">Vehicles</button>
            </div>
            <div class="inventory-list" id="inventoryList">
                <!-- Items populated by JS -->
            </div>
        </div>

        <!-- Stats Screen -->
        <div class="stats-screen" id="statsScreen">
            <div class="stats-grid">
                <div class="stat-card">
                    <div class="stat-label">Total Items</div>
                    <div class="stat-value" id="statTotalItems">0</div>
                </div>
                <div class="stat-card">
                    <div class="stat-label">Total Value</div>
                    <div class="stat-value money" id="statTotalValue">$0</div>
                </div>
                <div class="stat-card">
                    <div class="stat-label">Needs Repair</div>
                    <div class="stat-value" id="statNeedsRepair" style="color: var(--danger)">0</div>
                </div>
                <div class="stat-card">
                    <div class="stat-label">Locations</div>
                    <div class="stat-value" id="statLocations">0</div>
                </div>
            </div>

            <div class="recent-section">
                <div class="section-header">By Category</div>
                <div id="categoryBreakdown"></div>
            </div>
        </div>

        <!-- Smart Dashboard Screen -->
        <div class="smart-screen" id="smartScreen">
            <!-- Equipment Health Score -->
            <div class="health-card">
                <div class="health-score-ring">
                    <svg viewBox="0 0 120 120" width="120" height="120">
                        <circle class="health-score-bg" cx="60" cy="60" r="50"></circle>
                        <circle class="health-score-fill good" id="healthRing" cx="60" cy="60" r="50"
                            stroke-dasharray="0 314" style="transform: rotate(-90deg); transform-origin: center;"></circle>
                    </svg>
                    <div class="health-score-text">
                        <div class="health-score-value" id="healthScore">--</div>
                        <div class="health-score-label">Health</div>
                    </div>
                </div>
                <div style="font-size: 0.9rem; color: var(--text-secondary);" id="healthMessage">Loading...</div>
                <div class="health-summary">
                    <div class="health-stat">
                        <div class="health-stat-value good" id="healthGoodCount">-</div>
                        <div class="health-stat-label">Good</div>
                    </div>
                    <div class="health-stat">
                        <div class="health-stat-value warning" id="healthFairCount">-</div>
                        <div class="health-stat-label">Fair</div>
                    </div>
                    <div class="health-stat">
                        <div class="health-stat-value danger" id="healthAtRiskCount">-</div>
                        <div class="health-stat-label">At Risk</div>
                    </div>
                </div>
            </div>

            <!-- Critical Actions -->
            <div class="actions-card" id="criticalActions" style="display: none;">
                <div class="actions-header critical">
                    <i class="fas fa-exclamation-circle pulse"></i>
                    Critical - Act Now
                </div>
                <div id="criticalActionsList"></div>
            </div>

            <!-- This Week's Priorities -->
            <div class="actions-card" id="weekActions" style="display: none;">
                <div class="actions-header high">
                    <i class="fas fa-clock"></i>
                    This Week
                </div>
                <div id="weekActionsList"></div>
            </div>

            <!-- Seasonal Alerts -->
            <div class="actions-card" id="seasonalAlerts" style="display: none;">
                <div class="actions-header medium">
                    <i class="fas fa-leaf"></i>
                    Seasonal Readiness
                </div>
                <div id="seasonalAlertsList"></div>
            </div>

            <!-- At-Risk Equipment -->
            <div class="actions-card" id="atRiskCard" style="display: none;">
                <div class="actions-header" style="color: var(--danger);">
                    <i class="fas fa-exclamation-triangle"></i>
                    Equipment At Risk
                </div>
                <div id="atRiskList"></div>
            </div>

            <!-- Upcoming Maintenance -->
            <div class="actions-card" id="maintenanceCard" style="display: none;">
                <div class="actions-header info">
                    <i class="fas fa-tools"></i>
                    Upcoming Maintenance
                </div>
                <div id="maintenanceList"></div>
            </div>

            <!-- Replacement Forecast -->
            <div class="forecast-card" id="forecastCard" style="display: none;">
                <div class="forecast-header">
                    <span class="forecast-title"><i class="fas fa-chart-line"></i> 12-Month Replacement Forecast</span>
                    <span class="forecast-total" id="forecastTotal">$0</span>
                </div>
                <div id="forecastList"></div>
                <div style="margin-top: 12px; padding-top: 12px; border-top: 1px solid var(--border); text-align: center;">
                    <span style="color: var(--text-secondary); font-size: 0.85rem;">Monthly reserve: </span>
                    <span style="font-weight: 600; color: var(--primary-light);" id="monthlyReserve">$0</span>
                </div>
            </div>

            <!-- No Data State -->
            <div class="empty-state" id="smartEmptyState" style="display: none;">
                <i class="fas fa-brain"></i>
                <div style="font-weight: 600; margin-bottom: 8px;">No Smart Data Yet</div>
                <div>Add inventory items to see intelligent insights, predictions, and recommendations.</div>
            </div>
        </div>
    </main>

    <!-- Bottom Navigation -->
    <nav class="bottom-nav">
        <button class="nav-item active" id="navHome" onclick="showHome()">
            <i class="fas fa-home"></i>
            <span>Home</span>
        </button>
        <button class="nav-item" id="navSmart" onclick="showSmart()">
            <i class="fas fa-brain"></i>
            <span>Smart</span>
        </button>
        <button class="nav-item" id="navAdd" onclick="showAddForm()">
            <i class="fas fa-plus-circle"></i>
            <span>Add</span>
        </button>
        <button class="nav-item" id="navList" onclick="showList()">
            <i class="fas fa-list"></i>
            <span>Items</span>
        </button>
        <button class="nav-item" id="navStats" onclick="showStats()">
            <i class="fas fa-chart-bar"></i>
            <span>Stats</span>
        </button>
    </nav>

    <!-- Success Modal -->
    <div class="modal-overlay" id="successModal">
        <div class="modal">
            <div class="modal-icon">
                <i class="fas fa-check"></i>
            </div>
            <div class="modal-title">Saved!</div>
            <div class="modal-text" id="modalText">Item added successfully</div>
            <button class="modal-btn primary" onclick="addAnother()">
                <i class="fas fa-camera"></i> Add Another
            </button>
            <button class="modal-btn secondary" onclick="viewAll()">
                View All Items
            </button>
        </div>
    </div>

    <!-- Loading -->
    <div class="loading" id="loading">
        <div class="spinner"></div>
    </div>

    <!-- Toast -->
    <div class="toast" id="toast"></div>

    <!-- Hidden file inputs -->
    <input type="file" id="cameraInput" accept="image/*" capture="environment" onchange="handlePhoto(this)">
    <input type="file" id="galleryInput" accept="image/*" onchange="handlePhoto(this)">

    <script>
        const API_URL = 'https://script.google.com/macros/s/AKfycbwuNQFyABh3ccEc-HxoSVJ6Q0Oj54MkDk8vja0p-Jy53Yxyt8yC9H0Hq63j8xwW_5vH/exec';

        let allItems = [];
        let currentPhotoBase64 = null;
        let currentFilter = 'all';
        let gpsCoords = null;

        // Try to get GPS location
        if (navigator.geolocation) {
            navigator.geolocation.getCurrentPosition(
                pos => {
                    gpsCoords = {
                        lat: pos.coords.latitude,
                        lon: pos.coords.longitude
                    };
                },
                err => console.log('GPS unavailable:', err.message)
            );
        }

        // Initialize
        document.addEventListener('DOMContentLoaded', () => {
            loadInventory();
        });

        // Navigation
        function showHome() {
            hideAllScreens();
            document.getElementById('homeScreen').classList.remove('hidden');
            setActiveNav('navHome');
        }

        function showAddForm() {
            hideAllScreens();
            document.getElementById('formScreen').classList.add('active');
            setActiveNav('navAdd');
            resetForm();
        }

        function showList() {
            hideAllScreens();
            document.getElementById('listScreen').classList.add('active');
            setActiveNav('navList');
            renderInventoryList();
        }

        function showStats() {
            hideAllScreens();
            document.getElementById('statsScreen').classList.add('active');
            setActiveNav('navStats');
            loadStats();
        }

        function hideAllScreens() {
            document.getElementById('homeScreen').classList.add('hidden');
            document.getElementById('formScreen').classList.remove('active');
            document.getElementById('listScreen').classList.remove('active');
            document.getElementById('statsScreen').classList.remove('active');
            document.getElementById('smartScreen').classList.remove('active');
        }

        function showSmart() {
            hideAllScreens();
            document.getElementById('smartScreen').classList.add('active');
            setActiveNav('navSmart');
            loadSmartDashboard();
        }

        function setActiveNav(id) {
            document.querySelectorAll('.nav-item').forEach(n => n.classList.remove('active'));
            document.getElementById(id).classList.add('active');
        }

        // Photo handling
        function handlePhoto(input) {
            if (input.files && input.files[0]) {
                const file = input.files[0];
                const reader = new FileReader();

                reader.onload = function(e) {
                    // Compress and store
                    compressImage(e.target.result, 800, 0.7, (compressed) => {
                        currentPhotoBase64 = compressed.split(',')[1]; // Remove data URL prefix

                        const preview = document.getElementById('photoPreview');
                        preview.innerHTML = `<img src="${compressed}" alt="Preview">`;
                        preview.classList.add('has-photo');
                    });
                };

                reader.readAsDataURL(file);
            }
        }

        function compressImage(dataUrl, maxWidth, quality, callback) {
            const img = new Image();
            img.onload = function() {
                const canvas = document.createElement('canvas');
                let width = img.width;
                let height = img.height;

                if (width > maxWidth) {
                    height = (maxWidth / width) * height;
                    width = maxWidth;
                }

                canvas.width = width;
                canvas.height = height;

                const ctx = canvas.getContext('2d');
                ctx.drawImage(img, 0, 0, width, height);

                callback(canvas.toDataURL('image/jpeg', quality));
            };
            img.src = dataUrl;
        }

        // Form submission
        async function submitItem() {
            const itemName = document.getElementById('itemName').value.trim();
            const category = document.getElementById('category').value;
            const quantity = document.getElementById('quantity').value;
            const condition = document.querySelector('input[name="condition"]:checked').value;
            const location = document.getElementById('location').value;
            const estValue = document.getElementById('estValue').value;
            const serialModel = document.getElementById('serialModel').value;
            const notes = document.getElementById('notes').value;

            // Validation
            if (!itemName || !category || !location) {
                showToast('Please fill in all required fields');
                return;
            }

            showLoading(true);

            try {
                let photoUrl = '';

                // Upload photo first if exists
                if (currentPhotoBase64) {
                    const photoResult = await fetch(API_URL, {
                        method: 'POST',
                        body: JSON.stringify({
                            action: 'uploadFarmInventoryPhoto',
                            base64: currentPhotoBase64,
                            fileName: `inv_${Date.now()}.jpg`
                        })
                    });
                    const photoData = await photoResult.json();
                    if (photoData.success) {
                        photoUrl = photoData.url;
                    }
                }

                // Save item
                const itemData = {
                    action: 'addFarmInventoryItem',
                    itemName,
                    category,
                    quantity: parseInt(quantity) || 1,
                    condition,
                    location,
                    estValue: parseFloat(estValue) || 0,
                    serialModel,
                    notes,
                    photoUrl,
                    gpsLat: gpsCoords?.lat || '',
                    gpsLon: gpsCoords?.lon || ''
                };

                const response = await fetch(API_URL, {
                    method: 'POST',
                    body: JSON.stringify(itemData)
                });

                const result = await response.json();

                showLoading(false);

                if (result.success) {
                    document.getElementById('modalText').textContent =
                        `"${itemName}" added to ${location}`;
                    document.getElementById('successModal').classList.add('active');
                    loadInventory(); // Refresh data
                } else {
                    showToast('Error: ' + (result.error || 'Failed to save'));
                }
            } catch (error) {
                showLoading(false);
                showToast('Error: ' + error.message);
            }
        }

        function resetForm() {
            document.getElementById('itemName').value = '';
            document.getElementById('category').value = '';
            document.getElementById('quantity').value = '1';
            document.getElementById('condGood').checked = true;
            document.getElementById('location').value = '';
            document.getElementById('estValue').value = '';
            document.getElementById('serialModel').value = '';
            document.getElementById('notes').value = '';
            currentPhotoBase64 = null;

            const preview = document.getElementById('photoPreview');
            preview.innerHTML = `<i class="fas fa-camera"></i><span>Tap to take photo</span>`;
            preview.classList.remove('has-photo');
        }

        function addAnother() {
            document.getElementById('successModal').classList.remove('active');
            resetForm();
        }

        function viewAll() {
            document.getElementById('successModal').classList.remove('active');
            showList();
        }

        // Load inventory data
        async function loadInventory() {
            try {
                const response = await fetch(`${API_URL}?action=getFarmInventory`);
                const result = await response.json();

                if (result.success) {
                    allItems = result.data || [];
                    updateUI();
                }
            } catch (error) {
                console.error('Failed to load inventory:', error);
            }
        }

        function refreshData() {
            showToast('Refreshing...');
            loadInventory();
        }

        function updateUI() {
            // Update item count
            document.getElementById('itemCount').textContent = `${allItems.length} items`;

            // Calculate today's items
            const today = new Date().toDateString();
            const todayItems = allItems.filter(item => {
                const capturedDate = new Date(item.Captured_Date).toDateString();
                return capturedDate === today;
            });

            document.getElementById('todayCount').textContent = todayItems.length;

            // Progress bar (goal: 50 items per session)
            const progress = Math.min((todayItems.length / 50) * 100, 100);
            document.getElementById('progressFill').style.width = `${progress}%`;

            // Recent items
            renderRecentItems();

            // Last sync
            document.getElementById('lastSync').textContent =
                `Updated: ${new Date().toLocaleTimeString()}`;
        }

        function renderRecentItems() {
            const recentList = document.getElementById('recentList');
            const recent = [...allItems]
                .sort((a, b) => new Date(b.Captured_Date) - new Date(a.Captured_Date))
                .slice(0, 5);

            if (recent.length === 0) {
                recentList.innerHTML = `
                    <div class="recent-item" style="justify-content: center; color: var(--text-secondary);">
                        No items yet. Start adding!
                    </div>
                `;
                return;
            }

            recentList.innerHTML = recent.map(item => `
                <div class="recent-item">
                    <div class="recent-thumb">
                        ${item.Photo_URL
                            ? `<img src="${item.Photo_URL}" alt="${item.Item_Name}">`
                            : `<i class="fas fa-box"></i>`}
                    </div>
                    <div class="recent-info">
                        <div class="recent-name">${item.Item_Name}</div>
                        <div class="recent-meta">${item.Category}  ${item.Location}</div>
                    </div>
                </div>
            `).join('');
        }

        function renderInventoryList() {
            const list = document.getElementById('inventoryList');
            let filtered = allItems;

            if (currentFilter !== 'all') {
                filtered = allItems.filter(item => item.Category === currentFilter);
            }

            if (filtered.length === 0) {
                list.innerHTML = `
                    <div style="text-align: center; padding: 2rem; color: var(--text-secondary);">
                        No items found
                    </div>
                `;
                return;
            }

            list.innerHTML = filtered.map(item => `
                <div class="inventory-item">
                    <div class="item-photo">
                        ${item.Photo_URL
                            ? `<img src="${item.Photo_URL}" alt="${item.Item_Name}">`
                            : `<i class="fas fa-box"></i>`}
                    </div>
                    <div class="item-details">
                        <div class="item-name">${item.Item_Name}</div>
                        <div class="item-meta">${item.Category}  ${item.Location}</div>
                        <div class="item-meta">Qty: ${item.Quantity}  ${item.Condition}</div>
                        ${item.Est_Value ? `<div class="item-value">$${Number(item.Est_Value).toLocaleString()}</div>` : ''}
                    </div>
                </div>
            `).join('');
        }

        function filterItems(filter) {
            currentFilter = filter;

            // Update filter chips
            document.querySelectorAll('.filter-chip').forEach(chip => {
                chip.classList.toggle('active', chip.dataset.filter === filter);
            });

            renderInventoryList();
        }

        function filterByCondition(condition) {
            currentFilter = 'all';
            showList();

            // Filter to show only items needing repair
            const list = document.getElementById('inventoryList');
            const needsRepair = allItems.filter(item =>
                item.Condition === 'Needs Repair' || item.Condition === 'Poor'
            );

            if (needsRepair.length === 0) {
                list.innerHTML = `
                    <div style="text-align: center; padding: 2rem; color: var(--text-secondary);">
                        <i class="fas fa-check-circle" style="font-size: 2rem; color: var(--success); margin-bottom: 1rem;"></i>
                        <div>All items in good condition!</div>
                    </div>
                `;
                return;
            }

            list.innerHTML = needsRepair.map(item => `
                <div class="inventory-item">
                    <div class="item-photo">
                        ${item.Photo_URL
                            ? `<img src="${item.Photo_URL}" alt="${item.Item_Name}">`
                            : `<i class="fas fa-box"></i>`}
                    </div>
                    <div class="item-details">
                        <div class="item-name">${item.Item_Name}</div>
                        <div class="item-meta">${item.Category}  ${item.Location}</div>
                        <div class="item-meta" style="color: var(--danger);">
                            <i class="fas fa-wrench"></i> ${item.Condition}
                        </div>
                        ${item.Notes ? `<div class="item-meta">${item.Notes}</div>` : ''}
                    </div>
                </div>
            `).join('');
        }

        async function loadStats() {
            try {
                const response = await fetch(`${API_URL}?action=getFarmInventoryStats`);
                const result = await response.json();

                if (result.success) {
                    const stats = result.data;

                    document.getElementById('statTotalItems').textContent = stats.totalItems;
                    document.getElementById('statTotalValue').textContent =
                        '$' + stats.totalValue.toLocaleString();
                    document.getElementById('statNeedsRepair').textContent =
                        stats.needsRepair?.length || 0;
                    document.getElementById('statLocations').textContent =
                        Object.keys(stats.byLocation || {}).length;

                    // Category breakdown
                    const breakdown = document.getElementById('categoryBreakdown');
                    const categories = stats.byCategory || {};

                    breakdown.innerHTML = Object.entries(categories)
                        .sort((a, b) => b[1].value - a[1].value)
                        .map(([cat, data]) => `
                            <div class="recent-item">
                                <div class="recent-info" style="display: flex; justify-content: space-between;">
                                    <span>${cat}</span>
                                    <span>${data.count} items  $${data.value.toLocaleString()}</span>
                                </div>
                            </div>
                        `).join('');
                }
            } catch (error) {
                console.error('Failed to load stats:', error);
            }
        }

        // Utilities
        function showLoading(show) {
            document.getElementById('loading').classList.toggle('active', show);
        }

        function showToast(message) {
            const toast = document.getElementById('toast');
            toast.textContent = message;
            toast.classList.add('show');
            setTimeout(() => toast.classList.remove('show'), 3000);
        }

        // ============ SMART DASHBOARD ============
        async function loadSmartDashboard() {
            try {
                // Load all smart data in parallel
                const [dashboardRes, forecastRes, maintenanceRes] = await Promise.all([
                    fetch(`${API_URL}?action=getSmartDashboard`),
                    fetch(`${API_URL}?action=getReplacementForecast`),
                    fetch(`${API_URL}?action=getMaintenanceSchedule`)
                ]);

                const dashboard = await dashboardRes.json();
                const forecast = await forecastRes.json();
                const maintenance = await maintenanceRes.json();

                if (dashboard.success) {
                    renderSmartDashboard(dashboard.data, forecast.data, maintenance.data);
                } else {
                    document.getElementById('smartEmptyState').style.display = 'block';
                }
            } catch (error) {
                console.error('Failed to load smart dashboard:', error);
                showToast('Error loading smart data');
            }
        }

        function renderSmartDashboard(data, forecast, maintenance) {
            // Check if we have data
            if (!data || data.totalItems === 0) {
                document.getElementById('smartEmptyState').style.display = 'block';
                return;
            }
            document.getElementById('smartEmptyState').style.display = 'none';

            // Render Health Score
            renderHealthScore(data.health);

            // Render Recommendations by priority
            renderRecommendations(data.recommendations);

            // Render At-Risk Equipment
            renderAtRiskEquipment(data.health?.atRisk || []);

            // Render Maintenance Schedule
            renderMaintenanceSchedule(maintenance);

            // Render Replacement Forecast
            renderForecast(forecast);
        }

        function renderHealthScore(health) {
            if (!health) return;

            const score = health.overallScore || 0;
            const ring = document.getElementById('healthRing');
            const scoreEl = document.getElementById('healthScore');
            const messageEl = document.getElementById('healthMessage');

            // Calculate stroke-dasharray for SVG circle (circumference = 2 * PI * 50 = 314)
            const circumference = 314;
            const progress = (score / 100) * circumference;
            ring.style.strokeDasharray = `${progress} ${circumference}`;

            // Set color based on score
            ring.classList.remove('excellent', 'good', 'fair', 'poor');
            if (score >= 80) {
                ring.classList.add('excellent');
            } else if (score >= 60) {
                ring.classList.add('good');
            } else if (score >= 40) {
                ring.classList.add('fair');
            } else {
                ring.classList.add('poor');
            }

            scoreEl.textContent = Math.round(score) + '%';
            messageEl.textContent = health.message || 'Equipment health status';

            // Update counts
            document.getElementById('healthGoodCount').textContent = health.goodCondition || 0;
            document.getElementById('healthFairCount').textContent = health.fairCondition || 0;
            document.getElementById('healthAtRiskCount').textContent = (health.atRisk || []).length;
        }

        function renderRecommendations(recommendations) {
            if (!recommendations || recommendations.length === 0) {
                document.getElementById('criticalActions').style.display = 'none';
                document.getElementById('weekActions').style.display = 'none';
                document.getElementById('seasonalAlerts').style.display = 'none';
                return;
            }

            // Group by priority
            const critical = recommendations.filter(r => r.Priority === 'Critical');
            const high = recommendations.filter(r => r.Priority === 'High');
            const medium = recommendations.filter(r => r.Priority === 'Medium' || r.Priority === 'Low');

            // Render Critical
            if (critical.length > 0) {
                document.getElementById('criticalActions').style.display = 'block';
                document.getElementById('criticalActionsList').innerHTML = critical.map(r => renderActionItem(r, 'critical')).join('');
            } else {
                document.getElementById('criticalActions').style.display = 'none';
            }

            // Render High Priority (This Week)
            if (high.length > 0) {
                document.getElementById('weekActions').style.display = 'block';
                document.getElementById('weekActionsList').innerHTML = high.map(r => renderActionItem(r, 'high')).join('');
            } else {
                document.getElementById('weekActions').style.display = 'none';
            }

            // Render Medium/Low (Seasonal/Informational)
            if (medium.length > 0) {
                document.getElementById('seasonalAlerts').style.display = 'block';
                document.getElementById('seasonalAlertsList').innerHTML = medium.map(r => renderActionItem(r, 'medium')).join('');
            } else {
                document.getElementById('seasonalAlerts').style.display = 'none';
            }
        }

        function renderActionItem(rec, priority) {
            const icons = {
                'Maintenance': 'fa-wrench',
                'Replacement': 'fa-sync-alt',
                'Purchase': 'fa-shopping-cart',
                'Inspection': 'fa-search',
                'Seasonal': 'fa-leaf',
                'default': 'fa-exclamation'
            };
            const icon = icons[rec.Category] || icons.default;

            return `
                <div class="action-item">
                    <div class="action-icon ${priority}">
                        <i class="fas ${icon}"></i>
                    </div>
                    <div class="action-content">
                        <div class="action-title">${rec.Title}</div>
                        <div class="action-meta">${rec.Details || ''}</div>
                        ${rec.Est_Cost ? `<div class="action-meta" style="color: var(--primary-light);">Est. cost: $${Number(rec.Est_Cost).toLocaleString()}</div>` : ''}
                    </div>
                    <button class="action-btn" onclick="acknowledgeRecommendation('${rec.Recommendation_ID}')">
                        Done
                    </button>
                </div>
            `;
        }

        function renderAtRiskEquipment(atRisk) {
            if (!atRisk || atRisk.length === 0) {
                document.getElementById('atRiskCard').style.display = 'none';
                return;
            }

            document.getElementById('atRiskCard').style.display = 'block';
            document.getElementById('atRiskList').innerHTML = atRisk.slice(0, 5).map(item => {
                const riskPercent = (item.riskScore || 0) * 100;
                const riskLevel = riskPercent >= 70 ? 'high' : riskPercent >= 50 ? 'medium' : 'low';

                return `
                    <div class="risk-item">
                        <div class="risk-item-header">
                            <span class="risk-item-name">${item.name}</span>
                            <span class="risk-score ${riskLevel}">${Math.round(riskPercent)}% Risk</span>
                        </div>
                        <div class="risk-bar">
                            <div class="risk-bar-fill ${riskLevel}" style="width: ${riskPercent}%"></div>
                        </div>
                        <div class="risk-item-meta">
                            ${item.category || ''} ${item.condition ? ' ' + item.condition : ''} ${item.age ? ' ' + item.age : ''}
                        </div>
                    </div>
                `;
            }).join('');
        }

        function renderMaintenanceSchedule(maintenance) {
            if (!maintenance || !maintenance.upcoming || maintenance.upcoming.length === 0) {
                document.getElementById('maintenanceCard').style.display = 'none';
                return;
            }

            document.getElementById('maintenanceCard').style.display = 'block';
            document.getElementById('maintenanceList').innerHTML = maintenance.upcoming.slice(0, 5).map(item => `
                <div class="action-item">
                    <div class="action-icon low">
                        <i class="fas fa-wrench"></i>
                    </div>
                    <div class="action-content">
                        <div class="action-title">${item.itemName || item.Item_Name}</div>
                        <div class="action-meta">Due: ${formatDate(item.nextDue || item.Next_Maintenance)}</div>
                        ${item.estCost ? `<div class="action-meta" style="color: var(--primary-light);">Est. $${item.estCost}</div>` : ''}
                    </div>
                </div>
            `).join('');
        }

        function renderForecast(forecast) {
            if (!forecast || !forecast.items || forecast.items.length === 0) {
                document.getElementById('forecastCard').style.display = 'none';
                return;
            }

            document.getElementById('forecastCard').style.display = 'block';
            document.getElementById('forecastTotal').textContent = '$' + (forecast.totalCost || 0).toLocaleString();
            document.getElementById('monthlyReserve').textContent = '$' + Math.round((forecast.totalCost || 0) / 12).toLocaleString();

            document.getElementById('forecastList').innerHTML = forecast.items.slice(0, 5).map(item => `
                <div class="forecast-item">
                    <div>
                        <div class="forecast-item-name">${item.name}</div>
                        <div class="forecast-item-detail">${item.reason || ''}</div>
                    </div>
                    <div class="forecast-item-cost">$${(item.cost || 0).toLocaleString()}</div>
                </div>
            `).join('');
        }

        async function acknowledgeRecommendation(recId) {
            try {
                const response = await fetch(API_URL, {
                    method: 'POST',
                    body: JSON.stringify({
                        action: 'completeRecommendation',
                        recommendationId: recId
                    })
                });
                const result = await response.json();
                if (result.success) {
                    showToast('Marked as complete!');
                    loadSmartDashboard(); // Refresh
                }
            } catch (error) {
                showToast('Error updating recommendation');
            }
        }

        function formatDate(dateStr) {
            if (!dateStr) return 'Not set';
            const date = new Date(dateStr);
            const now = new Date();
            const diffDays = Math.ceil((date - now) / (1000 * 60 * 60 * 24));

            if (diffDays < 0) return 'Overdue!';
            if (diffDays === 0) return 'Today';
            if (diffDays === 1) return 'Tomorrow';
            if (diffDays <= 7) return `In ${diffDays} days`;

            return date.toLocaleDateString('en-US', { month: 'short', day: 'numeric' });
        }
    </script>
</body>
</html>
